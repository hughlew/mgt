# -*- coding:utf8 -*-
import socket
import time
import _thread
import os
from time import sleep

socket.setdefaulttimeout(1)

def socket_port(ip, port):
    try:
        if port >= 65535:
            return
        s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
        result = s.connect_ex((ip, port))
        if result == 0:
            lock.acquire()
            print(ip, u':', port, u'端口开放')
            lock.release()
        s.close()
    except Exception as e:
        pass

def ip_scan(ip):
    """
    输入IP，扫描IP的0-65534端口情况
    """
    try:
        print(u'开始扫描 %s' % ip)
        start_time = time.time()
        for j in range(0, 660):
            for i in range(j * 100, 100 * (j + 1)):
                #print(i)
                _thread.start_new_thread(socket_port, (ip, int(i)))
            sleep(0.2)  # 休眠 防止线程创建的过多报错（can not create new start thread）
        print('扫描端口完成，总共用时 ：%.2f' % (time.time() - start_time))
    except Exception as e:
        print('扫描ip出错',e)

if __name__ == '__main__':
    lock = _thread.allocate_lock()
    ipadd = ['52.78.8.232 ', '52.78.20.18 ', '13.209.79.171 ', '13.124.238.217 ', '52.78.11.4 ', '52.79.215.85 ', '52.78.51.38 ', '52.78.193.56 ', '13.209.39.15 ', '13.125.148.165 ', '52.78.149.13 ', '52.78.70.98 ', '13.125.55.241 ', '13.125.73.236 ', '13.124.255.29 ', '13.125.116.213 ', '52.78.81.74 ', '52.78.88.17 ', '52.78.90.180 ', '13.125.77.18 ', '13.125.114.83 ', '13.124.108.106 ', '52.79.201.234 ', '13.124.215.155 ', '13.125.123.73 ', '52.79.111.229 ', '52.78.163.36 ', '52.78.52.95 ', '13.124.13.248 ', '13.124.121.106 ', '52.78.45.16 ', '52.78.82.98 ', '52.78.201.95 ', '52.79.91.253 ', '52.78.38.148 ', '13.125.51.6 ', '13.124.222.39 ', '52.78.63.136 ', '52.79.126.172 ', '52.78.166.6 ', '13.124.121.162 ', '13.125.36.46 ', '52.78.105.40 ', '13.125.2.111 ', '52.78.62.184 ', '52.79.115.109 ', '52.79.191.157 ', '52.78.147.69 ', '13.125.67.65 ', '52.78.166.19 ', '52.78.67.117 ', '13.125.77.114 ', '13.124.64.8 ', '52.78.131.85 ', '52.79.171.120 ', '52.78.192.175 ', '52.78.186.227 ', '13.124.65.13 ', '52.79.182.151 ', '52.78.16.154 ', '13.124.220.217 ', '52.78.112.170 ', '52.197.190.41 ', '52.196.193.39 ', '176.34.52.221 ', '52.74.239.63 ', '52.74.222.107 ', '54.153.43.117 ', '52.79.101.133 ', '52.78.27.253 ', '52.79.101.38 ', '52.78.159.125 ', '52.78.36.132 ', '13.124.206.231 ', '52.79.230.105 ', '52.78.7.205 ', '52.78.182.126 ', '52.78.24.253 ', '52.79.39.132 ', '52.78.47.244 ', '52.78.29.160 ', '52.78.7.174 ', '13.124.7.85 ', '52.78.4.162 ', '52.78.165.204 ', '13.125.74.109 ', '52.78.11.94 ', '54.65.177.37 ', '54.92.81.232 ', '54.64.12.28 ', '52.68.235.135 ', '54.169.60.147 ', '52.70.100.49 ', '52.78.36.8 ', '52.78.118.23 ', '52.78.127.87 ', '52.79.190.30 ', '52.78.108.208 ', '52.79.188.133 ', '52.79.191.200 ', '52.78.55.84 ', '52.78.78.47 ', '52.78.71.174 ', '13.125.123.180 ', '52.78.25.95 ', '52.78.209.73 ', '52.78.2.56 ', '52.79.121.155 ', '52.78.74.252 ', '52.79.175.169 ', '52.79.125.91 ', '52.79.159.186 ', '52.79.156.129 ', '52.79.198.111 ', '52.79.104.173 ', '52.78.78.142 ', '52.78.4.46 ', '52.79.161.124 ', '13.124.16.121 ', '52.74.169.88 ', '13.229.163.99 ', '54.169.120.86 ', '54.254.196.25 ', '54.169.25.240 ', '52.5.46.139 ', '52.6.16.79 ', '52.6.64.95 ', '52.7.165.153 ', '13.124.99.82 ', '13.125.122.34 ', '13.125.215.94 ', '52.79.176.239 ', '13.125.230.52 ', '52.78.97.220 ', '13.209.82.221 ', '52.78.201.46 ', '13.124.162.172 ', '52.8.176.173 ', '52.9.62.178 ']
    for ip in ipadd:
        ip_scan(ip)
        #print(ip)
